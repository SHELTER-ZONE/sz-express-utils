var u=(e,n,o)=>new Promise((s,t)=>{var r=a=>{try{i(o.next(a))}catch(l){t(l)}},c=a=>{try{i(o.throw(a))}catch(l){t(l)}},i=a=>a.done?s(a.value):Promise.resolve(a.value).then(r,c);i((o=o.apply(e,n)).next())});import{verify as f}from"jsonwebtoken";var v=(e,n)=>(o,s,t)=>u(void 0,null,function*(){try{n==="query"?yield e.validateAsync(o.query):n==="body"&&(yield e.validateAsync(o.body))}catch(r){s.status(400).send(r.message);return}t()}),q=(e,n)=>(s,t,r)=>u(void 0,null,function*(){let c=s.headers.authorization;if(!c)return t.status(401).send("unauthorized");if(c)try{let i=f(c,n);if(!(yield e.fetch({id:i.user.id})).count)return t.status(401).send("forbidden")}catch(i){return t.status(401).send("internal server error")}r()});import m from"signale";import b from"dayjs";var g=new m.Signale({scope:"WebCrate",logLevel:process.env.LOG_LEVEL||"info",types:{success:{badge:"\u2705",color:"green",label:"success",logLevel:"debug"},info:{badge:"\u2139\uFE0F",color:"blue",label:"info",logLevel:"debug"},request:{badge:"\u{1F4EB}",color:"gray",label:"request",logLevel:"debug"},debug:{badge:"\u{1F537}",color:"cyan",label:"debug",logLevel:"info"},warn:{badge:"\u26A0\uFE0F",color:"yellow",label:"warn",logLevel:"info"}}}),d=({level:e,message:n})=>{if(Reflect.has(g,e)){let o=g[e];o({prefix:`[${b().format("YYYY-MM-DD HH:mm:ss")}]`,message:n,suffix:"(@klauscfhq)"});return}g.warn(`Invalid log level: ${e}`)};import y from"dayjs";var p=({status:e,code:n,message:o,data:s})=>({status:e,code:n||"",message:o||"",data:s}),k=(e,n,o)=>{n.ok=s=>{n.json(p({status:200,message:"ok",data:s}))},n.fail=({status:s,code:t,message:r})=>{s=s!=null?s:500,!r&&s===500&&(r="unknow server internal error"),n.status(s).json(p({status:s,code:t,message:r}))},o()},x=["js/","css/","img/","static/","_nuxt","manifest.json"],E=(e,n,o)=>{if(x.some(t=>e.originalUrl.includes(t))||e.method==="HEAD")return o();let s=y().format("YYYY-MM-DD HH:mm:ss");d({level:"request",message:`${s} ${e.method} ${e.originalUrl}`}),o()};function N(e,n,o){e.originalUrl==="/"&&n.set("Cache-control","no-store"),o()}export{N as disableCaching,x as ignoreRequestStrings,v as requestDataValidate,p as resFormat,E as routeLog,k as sendResponse,q as useApiAuthentication};
