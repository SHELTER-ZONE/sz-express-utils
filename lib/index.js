var u=(e,t,o)=>new Promise((r,s)=>{var n=a=>{try{i(o.next(a))}catch(l){s(l)}},c=a=>{try{i(o.throw(a))}catch(l){s(l)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(n,c);i((o=o.apply(e,t)).next())});import{verify as f}from"jsonwebtoken";var v=(e,t)=>(o,r,s)=>u(void 0,null,function*(){try{t==="query"?yield e.validateAsync(o.query):t==="body"&&(yield e.validateAsync(o.body))}catch(n){r.status(400).send(n.message);return}s()}),q=(e,t)=>(r,s,n)=>u(void 0,null,function*(){let c=r.headers.authorization;if(!c)return s.status(401).send("unauthorized");if(c)try{let i=f(c,t);if(!(yield e.fetch({id:i.user.id})).count)return s.status(401).send("forbidden")}catch(i){return s.status(401).send("internal server error")}n()});import m from"signale";import x from"dayjs";var g=new m.Signale({scope:"WebCrate",logLevel:process.env.LOG_LEVEL||"info",types:{success:{badge:"\u2705",color:"green",label:"success",logLevel:"debug"},info:{badge:"\u2139\uFE0F",color:"blue",label:"info",logLevel:"debug"},request:{badge:"\u{1F4EB}",color:"gray",label:"request",logLevel:"debug"},debug:{badge:"\u{1F537}",color:"cyan",label:"debug",logLevel:"info"},warn:{badge:"\u26A0\uFE0F",color:"yellow",label:"warn",logLevel:"info"}}}),p=({level:e,message:t})=>{if(Reflect.has(g,e)){let o=g[e];o({prefix:`[${x().format("YYYY-MM-DD HH:mm:ss")}]`,message:t,suffix:"(@klauscfhq)"});return}g.warn(`Invalid log level: ${e}`)};import b from"dayjs";var d=({status:e,code:t,message:o,data:r})=>({status:e,code:t||"",message:o||"",data:r}),k=(e,t,o)=>{t.ok=r=>{t.json(d({status:200,message:"ok",data:r}))},t.fail=({status:r,code:s,message:n})=>{r=r!=null?r:500,!n&&r===500&&(n="unknow server internal error"),t.status(r).json(d({status:r,code:s,message:n}))},o()},y=["js/","css/","img/","static/","_nuxt","manifest.json"],E=(e,t,o)=>{if(y.some(s=>e.originalUrl.includes(s))||e.method==="HEAD")return o();let r=b().format("YYYY-MM-DD HH:mm:ss");p({level:"request",message:`${r} ${e.method} ${e.originalUrl}`}),o()};function N(e,t,o){e.originalUrl==="/"&&t.set("Cache-control","no-store"),o()}export{N as disableCaching,y as ignoreRequestStrings,p as log,v as requestDataValidate,d as resFormat,E as routeLog,k as sendResponse,g as signale,q as useApiAuthentication};
