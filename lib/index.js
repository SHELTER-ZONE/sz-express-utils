var u=(e,t,o)=>new Promise((s,n)=>{var r=a=>{try{i(o.next(a))}catch(l){n(l)}},c=a=>{try{i(o.throw(a))}catch(l){n(l)}},i=a=>a.done?s(a.value):Promise.resolve(a.value).then(r,c);i((o=o.apply(e,t)).next())});import{verify as f}from"jsonwebtoken";var v=(e,t)=>(o,s,n)=>u(void 0,null,function*(){try{t==="query"?yield e.validateAsync(o.query):t==="body"&&(yield e.validateAsync(o.body))}catch(r){s.status(400).send(r.message);return}n()}),q=(e,t)=>(s,n,r)=>u(void 0,null,function*(){let c=s.headers.authorization;if(!c)return n.status(401).send("unauthorized");if(c)try{let i=f(c,t);if(!(yield e.fetch({id:i.user.id})).count)return n.status(401).send("forbidden")}catch(i){return n.status(401).send("internal server error")}r()});import m from"signale";import b from"dayjs";var g=new m.Signale({scope:"WebCrate",logLevel:process.env.LOG_LEVEL||"info",types:{success:{badge:"\u2705",color:"green",label:"success",logLevel:"debug"},info:{badge:"\u2139\uFE0F",color:"blue",label:"info",logLevel:"debug"},request:{badge:"\u{1F4EB}",color:"gray",label:"request",logLevel:"debug"},debug:{badge:"\u{1F537}",color:"cyan",label:"debug",logLevel:"info"},warn:{badge:"\u26A0\uFE0F",color:"yellow",label:"warn",logLevel:"info"}}}),d=({level:e,message:t})=>{if(Reflect.has(g,e)){let o=g[e];o({prefix:`[${b().format("YYYY-MM-DD HH:mm:ss")}]`,message:t,suffix:"(@klauscfhq)"});return}g.warn(`Invalid log level: ${e}`)};import x from"dayjs";var p=({status:e,code:t,message:o,data:s})=>({status:e,code:t||"",message:o||"",data:s}),k=(e,t,o)=>{t.ok=s=>{t.json(p({status:200,message:"ok",data:s}))},t.fail=({status:s,code:n,message:r})=>{s=s!=null?s:500,!r&&s===500&&(r="unknow server internal error"),t.status(s).json(p({status:s,code:n,message:r}))},o()},y=["js/","css/","img/","static/","_nuxt","manifest.json"],E=(e,t,o)=>{if(y.some(n=>e.originalUrl.includes(n))||e.method==="HEAD")return o();let s=x().format("YYYY-MM-DD HH:mm:ss");d({level:"request",message:`${s} ${e.method} ${e.originalUrl}`}),o()};function N(e,t,o){e.originalUrl==="/"&&t.set("Cache-control","no-store"),o()}export{N as disableCaching,y as ignoreRequestStrings,d as log,v as requestDataValidate,p as resFormat,E as routeLog,k as sendResponse,g as signale,q as useApiAuthentication};
