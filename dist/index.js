"use strict";var R=Object.create;var a=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty;var w=(e,o)=>{for(var s in o)a(e,s,{get:o[s],enumerable:!0})},p=(e,o,s,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of v(o))!L.call(e,n)&&n!==s&&a(e,n,{get:()=>o[n],enumerable:!(t=h(o,n))||t.enumerable});return e};var l=(e,o,s)=>(s=e!=null?R(q(e)):{},p(o||!e||!e.__esModule?a(s,"default",{value:e,enumerable:!0}):s,e)),F=e=>p(a({},"__esModule",{value:!0}),e);var E={};w(E,{disableCaching:()=>A,ignoreRequestStrings:()=>x,log:()=>u,requestDataValidate:()=>Y,resFormat:()=>g,routeLog:()=>j,sendResponse:()=>S,signale:()=>i,useApiAuthentication:()=>k});module.exports=F(E);var f=l(require("signale"),1),m=l(require("dayjs"),1),i=new f.default.Signale({scope:"WebCrate",logLevel:process.env.LOG_LEVEL||"info",types:{success:{badge:"\u2705",color:"green",label:"success",logLevel:"debug"},info:{badge:"\u2139\uFE0F",color:"blue",label:"info",logLevel:"debug"},request:{badge:"\u{1F4EB}",color:"gray",label:"request",logLevel:"debug"},debug:{badge:"\u{1F537}",color:"cyan",label:"debug",logLevel:"info"},warn:{badge:"\u26A0\uFE0F",color:"yellow",label:"warn",logLevel:"info"}}}),u=({level:e,message:o})=>{if(Reflect.has(i,e)){let s=i[e];s({prefix:`[${(0,m.default)().format("YYYY-MM-DD HH:mm:ss")}]`,message:o,suffix:"(@klauscfhq)"});return}i.warn(`Invalid log level: ${e}`)};var b=l(require("dayjs"),1),g=({status:e,code:o,message:s,data:t})=>({status:e,code:o||"",message:s||"",data:t}),S=(e,o,s)=>{o.ok=t=>{o.json(g({status:200,message:"ok",data:t}))},o.fail=({status:t,code:n,message:r})=>{t=t!=null?t:500,!r&&t===500&&(r="unknow server internal error"),o.status(t).json(g({status:t,code:n,message:r}))},s()},x=["js/","css/","img/","static/","_nuxt","manifest.json"],j=(e,o,s)=>{if(x.some(n=>e.originalUrl.includes(n))||e.method==="HEAD")return s();let t=(0,b.default)().format("YYYY-MM-DD HH:mm:ss");u({level:"request",message:`${t} ${e.method} ${e.originalUrl}`}),s()};function A(e,o,s){e.originalUrl==="/"&&o.set("Cache-control","no-store"),s()}var y=require("jsonwebtoken"),Y=(e,o)=>async(s,t,n)=>{try{o==="query"?await e.validateAsync(s.query):o==="body"&&await e.validateAsync(s.body)}catch(r){t.status(400).send(r.message);return}n()},k=(e,o)=>async(t,n,r)=>{let c=t.headers.authorization;if(!c)return n.status(401).send("unauthorized");if(c)try{let d=(0,y.verify)(c,o);if(!(await e.fetch({id:d.user.id})).count)return n.status(401).send("forbidden")}catch{return n.status(401).send("internal server error")}r()};0&&(module.exports={disableCaching,ignoreRequestStrings,log,requestDataValidate,resFormat,routeLog,sendResponse,signale,useApiAuthentication});
